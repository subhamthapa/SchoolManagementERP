<app-loading (loading)="(isLoading)"></app-loading>
<div class="container">
  <mat-card class="card-panel shadow p-3 mb-5 bg-white rounded edit-panel">
    <mat-card-header>
      <mat-icon style="margin-right: 20px">settings</mat-icon>
      <h6>Configure Home Page</h6>
      <mat-icon style="padding-left: 70%" (click)="close()">cancel</mat-icon>
    </mat-card-header>
    <mat-card-content style="position: relative">
      <h6>Edit Home Page</h6>
      <hr />
      <br />
      <br />
      <div id="website_carousel" class="carousel slide" data-interval="false">
        <div class="carousel-indicators" *ngIf="!addCarouselImage">
          <button
            type="button"
            data-bs-target="#website_carousel"
            [attr.data-bs-slide-to]="i"
            [class]="i == 0 ? 'active' : ''"
            *ngFor="
              let image of model.deferred_attributes['carousalImages'];
              let i = index
            "
          ></button>
        </div>
        <div class="carousel-inner" id="carousel_image_container">
          <div
            [class]="'carousel-item ' + (i == 0 ? 'active' : '')"
            style="height: calc(70vh)"
            *ngFor="
              let image of model.deferred_attributes['carousalImages'];
              let i = index
            "
          >
            <img
              src="{{ apiHost + image.image }}"
              alt=""
              class="d-block w-100"
              style="height: calc(70vh); object-fit: cover"
              [attr.img_id]="image.id"
              *ngIf="!image.filesystem"
              #ci
            />
            <img
              src="{{ image.image }}"
              alt=""
              class="d-block w-100"
              style="height: calc(70vh); object-fit: cover"
              *ngIf="image.filesystem"
              #ci
            />
          </div>
        </div>
      </div>
      <div *ngIf="model.deferred_attributes['carousalImages'].length > 1">
        <button
          mat-fab
          color="primary"
          style="margin-top: 10px"
          id="prev_img"
          class="image_button"
          #tooltip="matTooltip"
          matTooltip="Add website page"
          [attr.data-bs-target]="addCarouselImage ? '' : '#website_carousel'"
          [attr.data-bs-slide]="addCarouselImage ? '' : 'prev'"
          disabled="{{ addCarouselImage }}"
        >
          <mat-icon style="font-size: 24px" (click)="(false)"
            >chevron_left</mat-icon
          >
        </button>
        <button
          mat-fab
          color="primary"
          id="next_img"
          style="margin-top: 10px"
          class="image_button"
          #tooltip="matTooltip"
          matTooltip="Add website page"
          [attr.data-bs-target]="addCarouselImage ? '' : '#website_carousel'"
          [attr.data-bs-slide]="addCarouselImage ? '' : 'next'"
          disabled="{{ addCarouselImage }}"
        >
          <mat-icon style="font-size: 24px">chevron_right</mat-icon>
        </button>
      </div>
      <button
        mat-fab
        color="primary"
        style="margin-top: 10px"
        class="image_button add_rem"
        #tooltip="matTooltip"
        matTooltip="Add website page"
        *ngIf="!addCarouselImage"
        (click)="addCarouselImage = true"
      >
        <mat-icon>add</mat-icon>
      </button>
      <button
        mat-fab
        color="primary"
        class="image_button add_rem"
        style="margin-top: 10px"
        #tooltip="matTooltip"
        matTooltip="Add website page"
        *ngIf="addCarouselImage"
        (click)="addCarouselImage = false; cancelUploadCarouselImage()"
      >
        <mat-icon>close</mat-icon>
      </button>
      <button
        mat-fab
        color="primary"
        style="margin-top: 10px"
        id="delete_image"
        class="image_button"
        #tooltip="matTooltip"
        matTooltip="Add website page"
        disabled="{{ addCarouselImage }}"
        (click)="deleteCarouselImage()"
      >
        <mat-icon style="font-size: 24px">delete</mat-icon>
      </button>
    </mat-card-content>
    <div class="add-new-carousel-image" *ngIf="addCarouselImage">
      <label class="form-label" for="customFile">Upload a carousel image</label>
      <input
        type="file"
        class="form-control"
        id="customFile"
        accept="image/png, image/gif, image/jpeg"
        (change)="setImageFile($event)"
      />
    </div>
    <div>
      <button
        mat-fab
        color="primary"
        style="margin-top: 10px"
        #tooltip="matTooltip"
        matTooltip="Add website page"
        *ngIf="addCarouselImage"
        (click)="addCarouselImage = false; cancelUploadCarouselImage()"
      >
        <mat-icon>close</mat-icon>
      </button>
      &nbsp;
      <button
        mat-fab
        color="primary"
        style="margin-top: 10px"
        #tooltip="matTooltip"
        matTooltip="Add website page"
        *ngIf="addCarouselImage"
        (click)="addCarouselImage = true; uploadImageFileOnClick()"
      >
        <mat-icon>done</mat-icon>
      </button>
    </div>
    <h3>Image Notes</h3>
    <hr />
    <div>
      <div
        *ngFor="
          let imageNote of model.deferred_attributes['imageNotes'];
          let i = index
        "
        style="padding: 10px"
        class="row"
      >
        <div class="col-sm-3">
          <img
            src="{{ apiHost + imageNote.thumbnail }}"
            width="220"
            height="220"
            class="img-responsive"
          />
        </div>
        <div class="col-sm-9">
          <textarea
            id="text_area_{{ imageNote.id }}"
            class="form-control"
            rows="9"
            style="background-color: white"
            [disabled]="imageNote.disabled"
            >{{ imageNote.note }}</textarea
          >
          <div style="padding-top: 10px">
            <button
              mat-mini-fab
              color="primary"
              style="margin-top: 10px"
              #tooltip="matTooltip"
              matTooltip="Delete Image Note"
              style="float: right"
              (click)="deleteImageNote(imageNote.id, i)"
            >
              <mat-icon>delete</mat-icon>
            </button>
            <button
              mat-mini-fab
              color="primary"
              style="margin-top: 10px"
              #tooltip="matTooltip"
              [matTooltip]="imageNote.disabled ? 'Edit' : 'Cancel'"
              style="float: right; margin-right: 15px"
              (click)="
                imageNote.disabled = !imageNote.disabled;
                focus(imageNote.id, imageNote.disabled)
              "
            >
              <mat-icon *ngIf="imageNote.disabled">edit</mat-icon>
              <mat-icon *ngIf="!imageNote.disabled">close</mat-icon>
            </button>
            <button
              mat-mini-fab
              color="primary"
              style="margin-top: 10px"
              #tooltip="matTooltip"
              matTooltip="Delete Image Note"
              *ngIf="imageNote.disabled == false"
              style="float: right; margin-right: 15px"
              (click)="saveImageNote(imageNote.id, imageNote)"
            >
              <mat-icon>done</mat-icon>
            </button>
          </div>
        </div>
      </div>
      <div>
        <button
          mat-fab
          color="primary"
          style="margin-top: 10px"
          #tooltip="matTooltip"
          [matTooltip]="!addImageNote ? 'Add Image Note' : 'Cancel'"
          style="margin-right: 15px"
          (click)="addImageNote = !addImageNote"
        >
          <mat-icon *ngIf="!addImageNote">add</mat-icon>
          <mat-icon *ngIf="addImageNote">close</mat-icon>
        </button>
        <button
          mat-fab
          color="primary"
          style="margin-top: 10px"
          #tooltip="matTooltip"
          matTooltip="Save"
          style="margin-right: 15px"
          *ngIf="addImageNote"
          (click)="createImageNote()"
        >
          <mat-icon>done</mat-icon>
        </button>
        <div
          class="add-new-image_note"
          *ngIf="addImageNote"
          style="padding-bottom: 50px; padding-top: 10px"
        >
          <label class="form-label" for="customFile"
            >Add an Image note -
            <small style="color: indigo"
              >Please try to select a square image, if you select a rectangular
              image then the system will crop it automatically.</small
            >
          </label>
          <input
            type="file"
            class="form-control"
            id="customFile"
            accept="image/png, image/gif, image/jpeg"
            (change)="setImageNoteImage($event)"
          /><br />
          <textarea
            id="imageNoteText"
            class="form-control"
            placeholder="Type your note"
            rows="10"
          ></textarea>
        </div>
      </div>
    </div>
    <div>
      <br />
      <hr />
      <h3>Glimpses</h3>
      <div class="row">
        <div class="col-sm-4">
          <div
            *ngFor="
              let demoImage of demoImageGrid.defferedColumns[0];
              let i = index
            "
            class="social-media-control"
          >
            <img
              src="{{ apiHost + demoImage.thumbnail_rect }}"
              width="100%"
              class="demo_image"
            />
            <div class="clearfix imageGridElement" style="padding-top: 10px">
              <span class="float-end">
                <button
                  mat-mini-fab
                  color="primary"
                  style="margin-top: 10px"
                  style="float: right"
                  #tooltip="matTooltip"
                  matTooltip="Delete"
                  (click)="deleteDemoImage(demoImage.id, i, 0);"
                >
                  <mat-icon>delete</mat-icon>
                </button>
              </span>
            </div>
          </div>
        </div>
        <div class="col-sm-4">
          <div
            *ngFor="
              let demoImage of demoImageGrid.defferedColumns[1];
              let i = index
            "
            class="social-media-control"
          >
            <img
              src="{{ apiHost + demoImage.thumbnail_rect }}"
              width="100%"
              class="demo_image"
            />
            <div class="clearfix imageGridElement">
              <span class="float-end">
                <button
                  mat-mini-fab
                  color="primary"
                  style="margin-top: 10px"
                  style="float: right"
                  #tooltip="matTooltip"
                  matTooltip="Delete"
                  (click)="deleteDemoImage(demoImage.id, i, 1);"
                >
                  <mat-icon>delete</mat-icon>
                </button>
              </span>
            </div>
          </div>
        </div>
        <div class="col-sm-4">
          <div
            *ngFor="
              let demoImage of demoImageGrid.defferedColumns[2];
              let i = index
            "
            class="social-media-control"
          >
            <img
              src="{{ apiHost + demoImage.thumbnail_rect }}"
              width="100%"
              class="img-responsive demo_image"
            />
            <div class="clearfix imageGridElement">
              <span class="float-end">
                <button
                  mat-mini-fab
                  color="primary"
                  style="margin-top: 10px"
                  style="float: right"
                  #tooltip="matTooltip"
                  matTooltip="Delete"
                  (click)="deleteDemoImage(demoImage.id, i, 2);"
                >
                  <mat-icon>delete</mat-icon>
                </button>
              </span>
            </div>
          </div>
        </div>
      </div>
      <button
        mat-fab
        color="primary"
        style="margin-top: 10px"
        #tooltip="matTooltip"
        [matTooltip]="!addDemoImage ? 'Add Glimpses' : 'Cancel'"
        style="margin-right: 15px"
        (click)="addDemoImage = !addDemoImage"
      >
        <mat-icon *ngIf="!addDemoImage">add</mat-icon>
        <mat-icon *ngIf="addDemoImage">close</mat-icon>
      </button>
      <button
        mat-fab
        color="primary"
        style="margin-top: 10px"
        #tooltip="matTooltip"
        matTooltip="Save"
        *ngIf="addDemoImage"
        (click)="addDemoImage = true;uploadDemoImage()"
      >
        <mat-icon>done</mat-icon>
      </button>
      <div *ngIf="addDemoImage">
        <br />
        <label class="form-label" for="customFile">Upload Glimpses - <span style="color:indigo">Please select a rectangular image.</span></label>
        <input
          type="file"
          class="form-control"
          id="customFile"
          accept="image/png, image/gif, image/jpeg"
          (change)="setDemoImageFile($event)"
        />
      </div>
    </div>
  </mat-card>
</div>
